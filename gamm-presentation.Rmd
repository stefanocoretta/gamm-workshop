---
title: "An introduction to GAM(M)s"
author: "Stefano Coretta"
date: "12/07/2018"
output:
  beamer_presentation:
    includes:
      in_header: header.tex
header-includes:
- \linespread{1.5}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
theme_set(theme_minimal())
```

```{r data}
set.seed(8788)
x <- seq(0,100,1)
y <- ((runif(1, 10, 20) * x) / (runif(1, 0, 10) + x)) + rnorm(101, 0, 1)
x_1 <- seq(0, 100, 1)
y_1 <- ((runif(1, 10, 20) * x_1) / (runif(1, 0, 100) + x_1)) + rnorm(101, 0, 1)

sim_traj <- tibble(
  x = c(x, x_1),
  y = c(y, y_1),
  g = rep(c("a", "b"), each = 101)
)

sim_traj_a <- filter(sim_traj, g == "a")
```

## Linear models

\centering \Huge

Time travel...

## Linear models

\centering \Huge

$y = 3 + 2x$

\large

where $x = (2, 4, 5, 8, 10, 23, 36)$

## Linear models

```{r homework}
line <- tibble(
  x = c(2, 4, 5, 8, 10, 23, 36),
  y = 3 + 2 * x
)
ggplot(line, aes(x, y)) +
  geom_point() +
  labs(title = bquote(italic(y) == 3 + 2 * italic(x)))
```

## Linear models

```{r line}
ggplot(line, aes(x, y)) +
  geom_point(colour = "gray") +
  geom_line(colour = "red") +
  labs(title = bquote(italic(y) == 3 + 2 * italic(x)))
```

## Linear models

* In science, we have $x$ and $y$...

* for example, vowel duration and VOT

## Linear models

```{r sampled}
set.seed(4321)
x <- 1:10
y <- (1 + 1.5 * x) + rnorm(10, 0, 1)

line <- tibble(
  x = x,
  y = y
)
ggplot(line, aes(x, y)) +
  geom_point() +
  scale_x_continuous(breaks = 1:10) +
  labs(title = bquote(italic(y) == "?" + "?" * italic(x)))
```

## Linear models

* The formula: $y = \beta_0 + \beta_1x$
    * $\beta_0$ is the **intercept**
    * $\beta_1$ is the **slope**

* We know $x$ and $y$
    * we need to estimate $\beta_0$, $\beta_1$ = $\hat{\beta_0}, \hat{\beta_1}$

* We can add more predictors
    * $y = \beta_0 + \beta_1x_1 + \beta_2x_2 + ... + \beta_nx_n$

* `lm(y ~ x, data)` ('$y$ as a function of $x$')

## Linear models

```{r lm-plot}
ggplot(line, aes(x, y)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_continuous(breaks = 1:10) +
  labs(title = bquote({italic(y) == beta[0] + beta[1] * italic(x)} == 1 + 1.5 * italic(x)))
```

## Linear models

```{r error}
m <- lm(y ~ x)
yhat <- m$fitted.values
diff <- y - yhat  
ggplot(line, aes(x, y)) +
  geom_segment(aes(x = x, xend = x, y = y, yend = yhat), colour = "red") +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_continuous(breaks = 1:10) +
  labs(title = bquote(italic(y) == beta[0] + beta[1] * italic(x) + epsilon))
```

## LM with non-linear data

```{r plot-data}
ggplot(sim_traj_a, aes(x, y)) +
  geom_point() +
  labs(title = "Some non-linear data")
```

## LM with non-linear data

```{r plot-lm}
ggplot(sim_traj_a, aes(x, y)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Some non-linear data")
```

## LM with non-linear data

```{r error-2}
m <- lm(y ~ x, data = sim_traj_a)
yhat <- m$fitted.values
diff <- sim_traj_a$y - yhat  
ggplot(sim_traj_a, aes(x, y)) +
  geom_segment(aes(x = x, xend = x, y = y, yend = yhat), colour = "red") +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Some non-linear data")
```

## LM with non-linear data

How to account for non-linearity in a linear model?

* Use **higher-degree polynomials**
    * quadratic: $y = \beta_0 + \beta_1x + \beta_2x^2$
    * cubic: $y = \beta_0 + \beta_1x + \beta_2x^2 + \beta_3x^3$
    * $n$th: $y = \beta_0 + \beta_1x + \beta_2x^2 + \beta_3x^3 + ... + \beta_nx^n$

## LM with non-linear data

```{r 2-poly}
ggplot(sim_traj_a, aes(x, y)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x + I(x^2)) +
  labs(title = bquote(italic(y) == beta[0] + beta[1] * italic(x) + beta[2] * italic(x) ^ 2))
```

## LM with non-linear data

```{r 3-poly}
ggplot(sim_traj_a, aes(x, y)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x + I(x^2) + I(x^3)) +
  labs(title = bquote(italic(y) == beta[0] + beta[1] * italic(x) + beta[2] * italic(x) ^ 2 + beta[3] * italic(x) ^ 3))
```

## LM with non-linear data

```{r 10-poly}
ggplot(sim_traj_a, aes(x, y)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x + I(x^2) + I(x^3) + I(x^4) + I(x^5) + I(x^6) + I(x^7) + I(x^8) + I(x^9) + I(x^10)) +
  labs(title = bquote(italic(y) == beta[0] + beta[1] * italic(x) + beta[2] * italic(x) ^ 2 + beta[3] * italic(x) ^ 3 + beta[4] * italic(x) ^ 4 + beta[5] * italic(x) ^ 5 + beta[6] * italic(x) ^ 6 + beta[7] * italic(x) ^ 7 + beta[8] * italic(x) ^ 8 + beta[9] * italic(x) ^ 9 + beta[10] * italic(x) ^ 10))
```

## LM with non-linear data

```{r 10-poly-2, warning=FALSE}
ggplot(line, aes(x, y)) +
  geom_point(colour = "red", size = 2) +
  geom_smooth(method = "lm", se = FALSE, formula = y ~ x + I(x^2) + I(x^3) + I(x^4) + I(x^5) + I(x^6) + I(x^7) + I(x^8) + I(x^9) + I(x^10)) +
  scale_x_continuous(breaks = 1:10) +
  labs(title = bquote(italic(y) == beta[0] + beta[1] * italic(x) + beta[2] * italic(x) ^ 2 + beta[3] * italic(x) ^ 3 + beta[4] * italic(x) ^ 4 + beta[5] * italic(x) ^ 5 + beta[6] * italic(x) ^ 6 + beta[7] * italic(x) ^ 7 + beta[8] * italic(x) ^ 8 + beta[9] * italic(x) ^ 9 + beta[10] * italic(x) ^ 10))
```

## Generalised additive models

* **G**enrealised **A**dditive **M**odel**s**

* $y = f(x) + \epsilon$
    * $f(x)$ = 'some function of $x$' (or *smooth function*)

## Smooth terms

* LMs have **parametric terms**
    * $\beta_nx_n$ (`x` in `R`)
    * linear effects

* GAMs add (non-parametric) **smooth terms** (or simply smooths)
    * $f(x)$, `s(x)` in `R`
    * non-linear effects

* `gam(y ~ s(x), data)`, '$y$ as *some* function of $x$'

## Basis functions

* polynomials are a type of basis function
    * linear regression is the simplest polynomial (degree 1)

* **smoothing splines** are another type
    * there are several kinds of splines
    * each with their own basis functions



